<Window x:Class="ICCardManager.Views.Dialogs.BusStopInputDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:ICCardManager.ViewModels"
        mc:Ignorable="d"
        d:DataContext="{d:DesignInstance Type=vm:BusStopInputViewModel}"
        Title="ãƒã‚¹åœåå…¥åŠ›"
        Height="500"
        Width="650"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        AutomationProperties.Name="ãƒã‚¹åœåå…¥åŠ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚°"
        AutomationProperties.HelpText="ãƒã‚¹åˆ©ç”¨ã®ä¹—è»Šãƒ»é™è»Šãƒã‚¹åœåã‚’å…¥åŠ›ã—ã¾ã™ã€‚éŽåŽ»ã®å…¥åŠ›å±¥æ­´ã‹ã‚‰å€™è£œãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- èª¬æ˜Ž -->
        <Border Grid.Row="0" Background="{DynamicResource LendingBackgroundBrush}" CornerRadius="4" Padding="15" Margin="0,0,0,15">
            <StackPanel>
                <TextBlock Text="ãƒã‚¹åˆ©ç”¨ã®ãƒã‚¹åœåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                           FontSize="{DynamicResource BaseFontSize}"
                           FontWeight="Bold"
                           Foreground="{DynamicResource LendingForegroundBrush}"/>
                <TextBlock FontSize="{DynamicResource SmallFontSize}"
                           Foreground="#795548"
                           Margin="0,5,0,0"
                           TextWrapping="Wrap">
                    <Run Text="ãƒã‚¹åœåã¯ã€Œä¹—è»Šãƒã‚¹åœï½žé™è»Šãƒã‚¹åœã€ã®å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"/>
                    <LineBreak/>
                    <Run Text="ðŸ’¡ å…¥åŠ›ä¸­ã«éŽåŽ»ã®å±¥æ­´ã‹ã‚‰å€™è£œãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚å€™è£œã‚’ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯â†“â†‘ã‚­ãƒ¼ã§é¸æŠžã§ãã¾ã™ã€‚"/>
                </TextBlock>
            </StackPanel>
        </Border>

        <!-- ãƒã‚¹åˆ©ç”¨ä¸€è¦§ -->
        <ListView Grid.Row="1"
                  ItemsSource="{Binding BusUsages}"
                  BorderThickness="1"
                  BorderBrush="{DynamicResource SubtleBorderBrush}"
                  ScrollViewer.CanContentScroll="False">
            <ListView.ItemTemplate>
                <DataTemplate>
                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="80"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- æ—¥æ™‚ -->
                        <TextBlock Grid.Column="0"
                                   Text="{Binding UseDateDisplay}"
                                   VerticalAlignment="Center"
                                   FontSize="{DynamicResource SmallFontSize}"/>

                        <!-- é‡‘é¡ -->
                        <TextBlock Grid.Column="1"
                                   Text="{Binding AmountDisplay}"
                                   VerticalAlignment="Center"
                                   Foreground="{DynamicResource LendingForegroundBrush}"
                                   FontWeight="Bold"
                                   FontSize="{DynamicResource SmallFontSize}"/>

                        <!-- ãƒã‚¹åœåå…¥åŠ›ï¼ˆã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆä»˜ãï¼‰ -->
                        <Grid Grid.Column="2">
                            <TextBox Text="{Binding BusStops, UpdateSourceTrigger=PropertyChanged}"
                                     Padding="8"
                                     VerticalAlignment="Center"
                                     FontSize="{DynamicResource BaseFontSize}"
                                     AutomationProperties.Name="ãƒã‚¹åœå"
                                     AutomationProperties.HelpText="ä¹—è»Šãƒã‚¹åœï½žé™è»Šãƒã‚¹åœã®å½¢å¼ã§å…¥åŠ›ã€‚éŽåŽ»ã®å±¥æ­´ã‹ã‚‰å€™è£œãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚"
                                     ToolTip="ä¹—è»Šãƒã‚¹åœï½žé™è»Šãƒã‚¹åœï¼ˆä¾‹: å¤©ç¥žï½žåšå¤šé§…ï¼‰"/>

                            <!-- ã‚µã‚¸ã‚§ã‚¹ãƒˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
                            <Popup IsOpen="{Binding ShowSuggestions}"
                                   PlacementTarget="{Binding RelativeSource={RelativeSource AncestorType=Grid}}"
                                   Placement="Bottom"
                                   StaysOpen="False"
                                   AllowsTransparency="True"
                                   PopupAnimation="Fade">
                                <Border Background="{DynamicResource OnPrimaryBrush}"
                                        BorderBrush="{DynamicResource HeaderBackgroundBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        MaxHeight="200"
                                        MinWidth="300">
                                    <Border.Effect>
                                        <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.3"/>
                                    </Border.Effect>
                                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                                        <ItemsControl ItemsSource="{Binding FilteredSuggestions}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Padding="10,8"
                                                            Cursor="Hand"
                                                            Background="Transparent">
                                                        <Border.Style>
                                                            <Style TargetType="Border">
                                                                <Style.Triggers>
                                                                    <Trigger Property="IsMouseOver" Value="True">
                                                                        <Setter Property="Background" Value="{DynamicResource ReturnBackgroundBrush}"/>
                                                                    </Trigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>
                                                        <Border.InputBindings>
                                                            <MouseBinding MouseAction="LeftClick"
                                                                          Command="{Binding DataContext.SelectSuggestionCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                                          CommandParameter="{Binding}"/>
                                                        </Border.InputBindings>
                                                        <TextBlock Text="{Binding}"
                                                                   FontSize="{DynamicResource BaseFontSize}"
                                                                   Foreground="{DynamicResource WaitingForegroundBrush}"/>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                    <Setter Property="Padding" Value="0"/>
                    <Setter Property="Margin" Value="0"/>
                </Style>
            </ListView.ItemContainerStyle>
        </ListView>

        <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
        <TextBlock Grid.Row="2"
                   Text="{Binding StatusMessage}"
                   Foreground="{DynamicResource PrimaryBrush}"
                   FontWeight="Bold"
                   FontSize="{DynamicResource SmallFontSize}"
                   Margin="0,10,0,0"/>

        <!-- ãƒœã‚¿ãƒ³ -->
        <StackPanel Grid.Row="3"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,15,0,0">
            <Button Content="å¾Œã§å…¥åŠ›ï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰"
                    Command="{Binding SkipCommand}"
                    Padding="15,10"
                    Margin="0,0,10,0"
                    IsCancel="True"
                    FontSize="{DynamicResource BaseFontSize}"
                    AutomationProperties.Name="ã‚¹ã‚­ãƒƒãƒ—"
                    AutomationProperties.HelpText="ãƒã‚¹åœåã‚’å…¥åŠ›ã›ãšã«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‰ã˜ã¾ã™ã€‚å¾Œã§å…¥åŠ›ã§ãã¾ã™ã€‚"
                    ToolTip="å¾Œã§å…¥åŠ›ã™ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ— (Escape)"/>
            <Button Content="ä¿å­˜"
                    Command="{Binding SaveCommand}"
                    Padding="20,10"
                    Background="{DynamicResource SuccessActionBrush}"
                    Foreground="{DynamicResource OnPrimaryBrush}"
                    IsDefault="True"
                    FontSize="{DynamicResource BaseFontSize}"
                    AutomationProperties.Name="ãƒã‚¹åœåã‚’ä¿å­˜"
                    AutomationProperties.HelpText="å…¥åŠ›ã—ãŸãƒã‚¹åœåã‚’ä¿å­˜ã—ã¾ã™"
                    ToolTip="ãƒã‚¹åœåã‚’ä¿å­˜ (Enter)"/>
        </StackPanel>

        <!-- å‡¦ç†ä¸­ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
        <Border Grid.RowSpan="4"
                Background="{DynamicResource OverlayBrush}"
                Visibility="{Binding IsBusy, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="4"/>
                <TextBlock Text="{Binding BusyMessage}"
                           Foreground="{DynamicResource OnPrimaryBrush}"
                           FontSize="{DynamicResource BaseFontSize}"
                           Margin="0,10,0,0"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
