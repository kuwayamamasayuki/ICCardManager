<Window x:Class="ICCardManager.Views.Dialogs.VirtualCardDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="仮想交通系ICカード設定 [DEBUG]"
        Width="700" Height="550"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 説明 -->
        <TextBlock Grid.Row="0" Margin="0,0,0,12" TextWrapping="Wrap"
                   Foreground="Red" FontWeight="Bold">
            [DEBUG専用] 仮想的にICカードをタッチします。最大20件の履歴を指定できます。
        </TextBlock>

        <!-- カード・職員選択 -->
        <Grid Grid.Row="1" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0" Text="交通系ICカード:" VerticalAlignment="Center" Margin="0,0,8,0"/>
            <ComboBox Grid.Column="1" ItemsSource="{Binding CardSelectItems}"
                      SelectedItem="{Binding SelectedCard}"/>

            <TextBlock Grid.Column="3" Text="職員:" VerticalAlignment="Center" Margin="0,0,8,0"/>
            <ComboBox Grid.Column="4" ItemsSource="{Binding StaffSelectItems}"
                      SelectedItem="{Binding SelectedStaff}"/>
        </Grid>

        <!-- 履歴一覧 DataGrid -->
        <DataGrid Grid.Row="2" ItemsSource="{Binding Entries}"
                  SelectedItem="{Binding SelectedEntry}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False" CanUserDeleteRows="False"
                  CanUserSortColumns="False"
                  HeadersVisibility="Column"
                  SelectionMode="Single"
                  GridLinesVisibility="All"
                  Margin="0,0,0,8">
            <DataGrid.Columns>
                <DataGridTemplateColumn Header="日付" Width="130">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding UseDate, StringFormat=yyyy/MM/dd}" VerticalAlignment="Center" Margin="4,0"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                    <DataGridTemplateColumn.CellEditingTemplate>
                        <DataTemplate>
                            <DatePicker SelectedDate="{Binding UseDate, UpdateSourceTrigger=PropertyChanged}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellEditingTemplate>
                </DataGridTemplateColumn>

                <DataGridTextColumn Header="乗車駅" Width="*"
                                    Binding="{Binding EntryStation, UpdateSourceTrigger=PropertyChanged}"/>
                <DataGridTextColumn Header="降車駅" Width="*"
                                    Binding="{Binding ExitStation, UpdateSourceTrigger=PropertyChanged}"/>
                <DataGridTextColumn Header="残高" Width="80"
                                    Binding="{Binding Balance, UpdateSourceTrigger=PropertyChanged}"/>
                <DataGridCheckBoxColumn Header="チャージ" Width="70"
                                        Binding="{Binding IsCharge, UpdateSourceTrigger=PropertyChanged}"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- 追加・削除ボタン -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,0,0,16">
            <Button Content="追加" Command="{Binding AddEntryCommand}" Padding="16,4" Margin="0,0,8,0"/>
            <Button Content="削除" Command="{Binding RemoveEntryCommand}"
                    CommandParameter="{Binding SelectedEntry}" Padding="16,4" Margin="0,0,8,0"/>
            <TextBlock VerticalAlignment="Center" Foreground="Gray">
                <Run Text="{Binding Entries.Count, Mode=OneWay}"/><Run Text=" / 20 件"/>
            </TextBlock>
        </StackPanel>

        <!-- アクションボタン -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="タッチ実行" Command="{Binding ApplyAndTouchCommand}"
                    Padding="24,8" Margin="0,0,8,0" FontWeight="Bold"
                    Background="#4CAF50" Foreground="White"/>
            <Button Content="閉じる" Click="CloseButton_Click"
                    Padding="24,8"/>
        </StackPanel>
    </Grid>
</Window>
