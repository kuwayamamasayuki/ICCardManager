# ドキュメント設計書

## 1. ドキュメント概要

本書は、交通系ICカード貸出管理システムに関するドキュメントの構成と内容を定義する。

---

## 2. ドキュメント一覧

### 2.1 開発ドキュメント

| No | ドキュメント名 | ファイル名 | 目的 |
|----|--------------|-----------|------|
| 1 | システム概要設計書 | 01_システム概要設計書.md | システム全体の概要・方針を記述 |
| 2 | DB設計書 | 02_DB設計書.md | データベースの構造を定義 |
| 3 | 画面設計書 | 03_画面設計書.md | 画面レイアウトと遷移を定義 |
| 4 | 機能設計書 | 04_機能設計書.md | 各機能の詳細仕様を定義 |
| 5 | クラス設計書 | 05_クラス設計書.md | クラス構造とメソッドを定義 |
| 6 | シーケンス図 | 06_シーケンス図.md | 処理の流れを図示 |
| 7 | テスト設計書 | 07_テスト設計書.md | テスト計画とケースを定義 |
| 8 | ドキュメント設計書 | 08_ドキュメント設計書.md | 本書（ドキュメント構成を定義） |

### 2.2 利用者向けドキュメント

| No | ドキュメント名 | ファイル名 | 目的 |
|----|--------------|-----------|------|
| 1 | ユーザーマニュアル | ユーザーマニュアル.md / .docx | エンドユーザー向け操作説明 |
| 2 | ユーザーマニュアル概要版 | ユーザーマニュアル概要版.md / .docx | ユーザーマニュアルの概要版 |
| 3 | 管理者マニュアル | 管理者マニュアル.md / .docx | システム管理者向け説明 |
| 4 | 開発者ガイド | 開発者ガイド.md / .docx | 開発者向け技術ガイド |

> **注記**: クイックスタートガイドとトラブルシューティングガイドは、本設計書のセクション5,6で設計仕様を定義していますが、現時点では未作成です。

---

## 3. 操作マニュアル設計

### 3.1 マニュアル構成

```
操作マニュアル
├── 1. はじめに
│   ├── 1.1 本マニュアルについて
│   ├── 1.2 システムの概要
│   └── 1.3 用語説明
├── 2. 基本操作
│   ├── 2.1 アプリケーションの起動
│   ├── 2.2 画面構成の説明
│   ├── 2.3 ICカードリーダーの使い方
│   └── 2.4 アプリケーションの終了
├── 3. 貸出・返却操作
│   ├── 3.1 ICカードを借りる（貸出）
│   ├── 3.2 ICカードを返す（返却）
│   ├── 3.3 バス停名の入力
│   └── 3.4 よくある状況と対処
├── 4. 履歴の確認
│   ├── 4.1 利用履歴を見る
│   ├── 4.2 履歴の修正
│   └── 4.3 履歴の削除
├── 5. 帳票作成
│   ├── 5.1 月次帳票の作成
│   └── 5.2 Excelファイルの確認
├── 6. 付録
│   ├── 6.1 キーボードショートカット
│   └── 6.2 エラーメッセージ一覧
└── 索引
```

### 3.2 各章の詳細

#### 3.2.1 第1章 はじめに

**1.1 本マニュアルについて**
- 対象読者: 交通系ICカードを使用する全職員
- マニュアルの読み方
- 更新履歴

**1.2 システムの概要**
- システムの目的（物品出納簿の作成効率化）
- 対応するICカード（はやかけん、nimoca、SUGOCA等）
- 必要な機器（PC、PaSoRi）

**1.3 用語説明**

| 用語 | 説明 |
|------|------|
| 交通系ICカード | 電車・バスの乗車に使えるICカード |
| 職員証 | 職員を識別するためのICカード |
| 貸出 | ICカードを持ち出すこと |
| 返却 | ICカードを戻すこと |
| PaSoRi | ICカードリーダーの名称 |

---

#### 3.2.2 第2章 基本操作

**2.1 アプリケーションの起動**
```
【手順】
1. デスクトップの「交通系ICカード管理」アイコンをダブルクリック
2. メイン画面が表示されるまで待つ（数秒かかることがあります）
3. 「職員証をタッチしてください」と表示されれば準備完了
```

**2.2 画面構成の説明**
- ヘッダー部（タイトル、メニュー）
- メイン部（状態表示、メッセージ）
- 警告エリア（残額警告等）
- ステータスバー（現在時刻、接続状態）

図を含める: メイン画面の各部説明

**2.3 ICカードリーダーの使い方**
```
【正しいタッチの方法】
・カードをリーダーの中央に置く
・「ピッ」と音がするまで離さない
・音が鳴ったらカードを離してOK

【うまく読み取れないとき】
・カードの向きを変えてみる
・カードケースから出す
・ゆっくり置いてみる
```

図を含める: カードの置き方イラスト

---

#### 3.2.3 第3章 貸出・返却操作

**3.1 ICカードを借りる（貸出）**
```
【手順】
1. 職員証をリーダーにタッチ
   → 「交通系ICカードをタッチしてください」と表示
2. 借りたいICカードをリーダーにタッチ
   → 「いってらっしゃい！」と表示（背景が黄緑色）
3. ICカードを持って出発

【確認】
・画面に自分の名前が表示されていますか？
・「いってらっしゃい！」と表示されましたか？
```

図を含める: 貸出操作のフローチャート

**3.2 ICカードを返す（返却）**
```
【手順】
1. 職員証をリーダーにタッチ
   → 「交通系ICカードをタッチしてください」と表示
2. 返却するICカードをリーダーにタッチ
   → 「おかえりなさい！」と表示（背景が水色）
3. バスを利用した場合はバス停名入力画面が表示
   → 乗車したバス停名を入力
4. 返却完了

【確認】
・利用履歴が正しく表示されていますか？
・バス停名の入力を忘れていませんか？
```

図を含める: 返却操作のフローチャート

**3.3 バス停名の入力**
```
【バスを利用したとき】
バスを利用すると、返却時にバス停名を入力する画面が表示されます。

【入力例】
・博多駅 → 市役所前
・天神 → 藤崎

【ポイント】
・正確なバス停名がわからない場合は、おおよその名前でOK
・後から履歴画面で修正することもできます
```

**3.4 よくある状況と対処**

| 状況 | 対処方法 |
|------|---------|
| 「このカードは貸出中です」と表示 | すでに誰かが使用中。別のカードを選ぶ |
| 「未登録のカードです」と表示 | 管理者に連絡してカードを登録してもらう |
| 残額警告が出た | チャージが必要。経理担当に連絡 |

---

#### 3.2.4 第4章 履歴の確認

**4.1 利用履歴を見る**
```
【手順】
1. 確認したいICカードをリーダーにタッチ
   ※職員証は不要（タッチしない）
2. 履歴表示画面が開く
3. スクロールして過去の履歴を確認

【表示項目】
・日付: 利用した日
・摘要: どこからどこまで乗ったか
・払出金額: 使った金額
・残額: 残りの金額
・氏名: 使った人
```

**4.2 履歴の修正**
```
【修正が必要なとき】
・バス停名が「★」のままになっている
・摘要に誤りがある

【手順】
1. 履歴表示画面で修正したい行の「修正」ボタンをクリック
2. 職員証をタッチ
3. 内容を修正
4. 「完了」ボタンをクリック
```

---

#### 3.2.5 第5章 帳票作成

**5.1 月次帳票の作成**
```
【手順】
1. F6キーを押す（または「月次帳票」メニューをクリック）
2. 対象の年月を選択
3. 出力するカードを選択（複数選択可）
4. 「Excelファイル作成」ボタンをクリック
5. 保存先を選択して「保存」

【出力ファイル】
・カードごとに1ファイル作成
・ファイル名: 物品出納簿_はやかけん001_R7年11月.xlsx
```

---

#### 3.2.6 第6章 付録

**6.1 キーボードショートカット**

| キー | 機能 |
|------|------|
| F6 | 月次帳票作成画面を開く |
| F7 | ICカード管理画面を開く |
| F8 | 職員管理画面を開く |
| F9 | 設定画面を開く |
| Esc | 操作をキャンセル/画面を閉じる |

**6.2 エラーメッセージ一覧**

| メッセージ | 意味 | 対処 |
|-----------|------|------|
| カードリーダーが見つかりません | PaSoRiが接続されていない | USBを確認 |
| カードを読み取れませんでした | タッチがうまくいかなかった | 再度タッチ |
| このカードは登録されていません | 未登録のカード | 管理者に連絡 |

---

## 4. 管理者マニュアル設計

### 4.1 マニュアル構成

```
管理者マニュアル
├── 1. はじめに
│   ├── 1.1 管理者の役割
│   └── 1.2 システム構成
├── 2. 初期設定
│   ├── 2.1 インストール
│   ├── 2.2 ICカードリーダーの設定
│   ├── 2.3 初回起動と初期設定
│   └── 2.4 職員・ICカードの登録
├── 3. 日常管理
│   ├── 3.1 職員の追加・修正・削除
│   ├── 3.2 ICカードの追加・修正・削除
│   ├── 3.3 バックアップの確認
│   └── 3.4 操作ログの確認
├── 4. 定期メンテナンス
│   ├── 4.1 データベースの最適化
│   ├── 4.2 古いデータの削除
│   └── 4.3 バックアップの管理
├── 5. トラブル対応
│   ├── 5.1 バックアップからの復旧
│   ├── 5.2 よくあるトラブルと対処
│   └── 5.3 ログの分析
└── 6. 付録
    ├── 6.1 データベース構造
    ├── 6.2 設定ファイル一覧
    └── 6.3 連絡先
```

### 4.2 各章の詳細

#### 4.2.1 第2章 初期設定

**2.1 インストール**
```
【システム要件】
・OS: Windows 11
・メモリ: 4GB以上
・ストレージ: 100MB以上の空き
・USB: PaSoRi接続用

【インストール手順】
1. インストーラーを実行（ICCardManager_Setup.exe）
2. インストール先を確認（デフォルト: C:\Program Files\ICCardManager）
3. 「インストール」をクリック
4. 完了後、デスクトップにショートカットが作成される
```

**2.2 ICカードリーダーの設定**
```
【PaSoRi RC-S300/RC-S380の場合】
1. USBポートに接続
2. ドライバが自動インストールされる
3. デバイスマネージャーで認識を確認
   → 「スマートカード読み取り装置」に表示

【注意】
・初回接続時はインターネット接続が必要（ドライバ取得）
・オフライン環境の場合は、事前にドライバをダウンロードしておく
```

**2.4 職員・ICカードの登録**
```
【職員の登録】
1. F8キーで職員管理画面を開く
2. 「追加」ボタンをクリック
3. 管理者の職員証をタッチ（操作者認証）
4. 登録する職員証をタッチ
5. 氏名、職員番号を入力
6. 「登録」をクリック

【ICカードの登録】
1. F7キーでICカード管理画面を開く
2. 「追加」ボタンをクリック
3. 管理者の職員証をタッチ（操作者認証）
4. 登録するICカードをタッチ
5. 通し番号を入力（カード種別は自動判別）
6. 「登録」をクリック
```

---

#### 4.2.2 第3章 日常管理

**3.1 職員の追加・修正・削除**
```
【削除時の注意】
・削除は「論理削除」です
・削除後も過去の履歴に職員名が表示されます
・完全に削除することはできません（データ整合性のため）

【退職者の処理】
1. 職員管理画面で対象者を選択
2. 「削除」ボタンをクリック
3. 確認ダイアログで「OK」をクリック
4. 職員証をタッチ（操作者認証）
```

**3.3 バックアップの確認**
```
【自動バックアップ】
・アプリ起動時に自動実行
・保存先: (アプリフォルダ)\backup
・ファイル名: backup_YYYYMMDD_HHMMSS.db
・保持世代: 30世代

【確認手順】
1. バックアップフォルダを開く
2. 最新のバックアップファイルの日時を確認
3. ファイルサイズが0でないことを確認
```

---

#### 4.2.3 第5章 トラブル対応

**5.1 バックアップからの復旧**
```
【復旧が必要な場合】
・データベースが破損した
・誤ってデータを削除した
・ウイルス感染などでファイルが消失した

【復旧手順】
1. アプリケーションを終了
2. 現在のDBファイルをリネーム（例: iccard.db.old）
3. バックアップフォルダから復旧したいファイルをコピー
4. ファイル名を「iccard.db」に変更
5. アプリケーションを起動
6. データを確認
```

**5.2 よくあるトラブルと対処**

| 症状 | 原因 | 対処 |
|------|------|------|
| カードが読めない | リーダー接続不良 | USB再接続 |
| 起動しない | DBファイル破損 | バックアップから復旧 |
| 動作が遅い | データ肥大化 | DB最適化を実行 |
| Excel出力エラー | 空き容量不足 | ディスク整理 |

---

## 5. クイックスタートガイド設計

### 5.1 ガイド構成（A4両面1枚）

**表面**
```
┌─────────────────────────────────────────┐
│     交通系ICカード管理システム            │
│         クイックスタートガイド            │
├─────────────────────────────────────────┤
│                                         │
│  ■ ICカードを借りるとき                 │
│  ┌─────────────────────────────────┐   │
│  │ 1. 職員証をタッチ              │   │
│  │    ↓                          │   │
│  │ 2. ICカードをタッチ            │   │
│  │    ↓                          │   │
│  │ 「いってらっしゃい！」         │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ■ ICカードを返すとき                   │
│  ┌─────────────────────────────────┐   │
│  │ 1. 職員証をタッチ              │   │
│  │    ↓                          │   │
│  │ 2. ICカードをタッチ            │   │
│  │    ↓                          │   │
│  │ 「おかえりなさい！」           │   │
│  │    ↓                          │   │
│  │ バスを使った場合は             │   │
│  │ バス停名を入力                 │   │
│  └─────────────────────────────────┘   │
│                                         │
└─────────────────────────────────────────┘
```

**裏面**
```
┌─────────────────────────────────────────┐
│  ■ 履歴を確認するとき                   │
│  ┌─────────────────────────────────┐   │
│  │ ICカードだけをタッチ           │   │
│  │ （職員証は不要）               │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ■ キーボードショートカット             │
│  ┌─────────────────────────────────┐   │
│  │ F6: 月次帳票作成               │   │
│  │ F7: ICカード管理               │   │
│  │ F8: 職員管理                   │   │
│  │ Esc: キャンセル                │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ■ 困ったときは                         │
│  ┌─────────────────────────────────┐   │
│  │ ・カードが読めない             │   │
│  │   → カードを置き直す          │   │
│  │                                │   │
│  │ ・「未登録」と表示される       │   │
│  │   → 管理者に連絡              │   │
│  │                                │   │
│  │ ・その他のトラブル             │   │
│  │   → 管理者に連絡              │   │
│  │                                │   │
│  │ 管理者連絡先: ○○課 内線XXX   │   │
│  └─────────────────────────────────┘   │
│                                         │
└─────────────────────────────────────────┘
```

---

## 6. トラブルシューティングガイド設計

### 6.1 ガイド構成

```
トラブルシューティングガイド
├── 1. カード読み取りの問題
│   ├── カードが認識されない
│   ├── 読み取りに時間がかかる
│   └── 「未登録カード」と表示される
├── 2. 貸出・返却の問題
│   ├── 「貸出中です」と表示される
│   ├── 返却時に履歴が読み取れない
│   └── バス停入力画面が出ない
├── 3. 画面表示の問題
│   ├── 画面が真っ白になる
│   ├── 文字が小さい/大きい
│   └── 画面がフリーズする
├── 4. 帳票出力の問題
│   ├── Excelファイルが作成されない
│   ├── 出力内容がおかしい
│   └── ファイルが開けない
├── 5. システムの問題
│   ├── アプリが起動しない
│   ├── データが消えた
│   └── 動作が遅い
└── 6. 連絡先
```

### 6.2 各問題の詳細

#### 6.2.1 カード読み取りの問題

**カードが認識されない**

| 確認項目 | 対処方法 |
|---------|---------|
| USBが抜けていないか | USBを差し直す |
| カードの向きは正しいか | カードを置き直す |
| カードケースに入っていないか | ケースから出す |
| 他のカードと重なっていないか | 1枚ずつタッチ |
| リーダーのランプは点灯しているか | 点灯していなければUSB確認 |

**それでも解決しない場合:**
1. PCを再起動
2. 別のUSBポートに接続
3. 管理者に連絡

---

## 7. ドキュメント管理

### 7.1 バージョン管理

| バージョン | 日付 | 変更内容 | 担当者 |
|-----------|------|---------|--------|
| 1.0 | YYYY/MM/DD | 初版作成 | - |

### 7.2 レビュー・承認

| 役割 | 担当者 | 日付 | 署名 |
|------|--------|------|------|
| 作成者 | - | - | |
| レビュアー | - | - | |
| 承認者 | - | - | |

### 7.3 配布先

| ドキュメント | 配布先 | 状態 |
|-------------|--------|------|
| ユーザーマニュアル | 全職員 | ✅ 作成済み |
| ユーザーマニュアル概要版 | 全職員 | ✅ 作成済み |
| 管理者マニュアル | システム管理者 | ✅ 作成済み |
| 開発者ガイド | 開発担当者 | ✅ 作成済み |
| クイックスタートガイド | 全職員（カードリーダー設置場所に掲示） | 📋 設計済み・未作成 |
| トラブルシューティング | システム管理者、ヘルプデスク | 📋 設計済み・未作成 |
