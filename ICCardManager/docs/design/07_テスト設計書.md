# テスト設計書

## 1. テスト概要

### 1.1 テスト目的
本テスト設計書は、交通系ICカード貸出管理システムの品質を保証するためのテスト計画・テストケースを定義する。

### 1.1a テスト規模（現状）

| 種別 | テスト数 | 備考 |
|------|---------|------|
| 単体テスト（ICCardManager.Tests） | 1,613件 | xUnit + FluentAssertions + Moq |
| UIテスト（ICCardManager.UITests） | 9件 | |
| **合計** | **1,622件** | 全件パス |

### 1.2 テスト範囲

| テストレベル | 対象 | 担当 |
|-------------|------|------|
| 単体テスト | 各クラス・メソッド | 開発者 |
| 結合テスト | 機能間連携 | 開発者 |
| システムテスト | システム全体 | テスト担当者 |
| 受入テスト | ユーザー視点の動作確認 | 利用者 |

### 1.3 テスト環境

| 項目 | 仕様 |
|------|------|
| OS | Windows 11 |
| .NET | .NET Framework 4.8 |
| ICカードリーダー | PaSoRi (RC-S300/RC-S380) |
| テスト用ICカード | はやかけん、nimoca、SUGOCA等 |
| テスト用職員証 | FeliCa対応カード |

---

## 2. 単体テスト

### 2.1 カード種別表示名変換（CardTypeDetector）

> **注意**: IDmの先頭2バイトは「製造者コード」であり「カード種別」ではないため、IDmからカード種別を自動判別することは技術的に不可能である。カード種別はユーザーが登録時に手動で選択する。CardTypeDetectorの役割はカード種別の選択肢提供と表示名変換に限定される。

#### UT-001: カード種別の表示名変換

| No | テストケース | 入力 | 期待結果 |
|----|-------------|------|---------|
| 1 | はやかけん表示名 | CardType.Hayakaken | "はやかけん" |
| 2 | nimoca表示名 | CardType.Nimoca | "nimoca" |
| 3 | SUGOCA表示名 | CardType.SUGOCA | "SUGOCA" |
| 4 | Suica表示名 | CardType.Suica | "Suica" |
| 5 | PASMO表示名 | CardType.PASMO | "PASMO" |
| 6 | ICOCA表示名 | CardType.ICOCA | "ICOCA" |
| 7 | PiTaPa表示名 | CardType.PiTaPa | "PiTaPa" |
| 8 | Kitaca表示名 | CardType.Kitaca | "Kitaca" |
| 9 | TOICA表示名 | CardType.TOICA | "TOICA" |
| 10 | manaca表示名 | CardType.Manaca | "manaca" |
| 11 | 不明種別 | CardType.Unknown | "その他" |

---

### 2.2 バス利用判別ロジック

#### UT-002: バス利用判別

バス利用の判定条件: `!isCharge && !isPointRedemption` かつ、以下のいずれかに該当する場合。
1. 駅コードが両方0（従来のバス判定）
2. 駅コードはあるが駅名が両方とも解決できなかった場合（西鉄バス等）

| No | テストケース | 乗車駅 | 降車駅 | is_charge | is_point_redemption | 期待結果 |
|----|-------------|--------|--------|-----------|---------------------|---------|
| 1 | 通常の鉄道利用 | "博多" | "天神" | false | false | is_bus = false |
| 2 | バス利用（駅コード0） | "" | "" | false | false | is_bus = true |
| 3 | バス利用（null） | null | null | false | false | is_bus = true |
| 4 | チャージ | "" | "" | true | false | is_bus = false |
| 5 | ポイント還元 | "" | "" | false | true | is_bus = false |
| 6 | 片道のみ記録 | "博多" | "" | false | false | is_bus = false |
| 7 | 西鉄バス（駅コードあり・駅名解決不可） | null※ | null※ | false | false | is_bus = true |

> ※ No.7: 駅コードは非ゼロだが、StationMasterServiceで駅名に解決できないケース。西鉄バス等の交通機関で発生する。

---

### 2.3 摘要文字列生成（SummaryGenerator）

#### UT-003: 摘要文字列生成

| No | テストケース | 入力 | 期待結果 |
|----|-------------|------|---------|
| 1 | 単純片道 | A駅→B駅 | "鉄道（A駅～B駅）" |
| 2 | 往復利用 | A駅→B駅、B駅→A駅 | "鉄道（A駅～B駅 往復）" |
| 3 | 乗継利用 | A駅→B駅、B駅→C駅 | "鉄道（A駅～C駅）" |
| 4 | 複数区間 | A駅→B駅、C駅→D駅 | "鉄道（A駅～B駅、C駅～D駅）" |
| 5 | バス併用 | A駅→B駅 + バス | "鉄道（A駅～B駅）、バス（★）" |
| 6 | バスのみ | バス利用 | "バス（★）" |
| 7 | チャージ（市長事務部局） | チャージ3000円 | "役務費によりチャージ" |
| 8 | チャージ（企業会計部局） | チャージ3000円 | "旅費によりチャージ" |
| 9 | ポイント還元 | ポイント還元 | "ポイント還元" |
| 10 | 払い戻し | 払い戻し処理 | "払戻しによる払出" |

---

### 2.4 和暦変換（WarekiConverter）

#### UT-004: 和暦変換

| No | テストケース | 入力 | 期待結果 |
|----|-------------|------|---------|
| 1 | 令和通常日付 | 2025-11-05 | "R7.11.05" |
| 2 | 令和元年 | 2019-05-01 | "R1.05.01" |
| 3 | 平成最終日 | 2019-04-30 | "H31.04.30" |
| 4 | 1桁月日 | 2025-01-05 | "R7.01.05" |
| 5 | 年度開始日 | 2025-04-01 | "R7.04.01" |

---

### 2.5 残額計算（BalanceCalculator）

#### UT-005: 残額計算

| No | テストケース | 前残額 | 受入 | 払出 | 期待結果 |
|----|-------------|-------|------|------|---------|
| 1 | チャージのみ | 1000 | 3000 | 0 | 4000 |
| 2 | 利用のみ | 4000 | 0 | 500 | 3500 |
| 3 | チャージと利用 | 1000 | 3000 | 500 | 3500 |
| 4 | 残額ゼロ | 500 | 0 | 500 | 0 |
| 5 | 繰越計算 | 5000 | 0 | 0 | 5000 |

---

### 2.6 履歴分割サービス（LedgerSplitService）

#### UT-006: 履歴分割処理

| No | テストケース | 期待結果 |
|----|-------------|---------|
| 1 | 2グループに分割 | 元Ledger更新 + 新Ledger1件作成 |
| 2 | 3グループ以上に分割 | 元Ledger更新 + 新Ledger(N-1)件作成 |
| 3 | 金額再計算（CalculateGroupFinancials） | グループ内の受入/払出/残額が正しく算出される |
| 4 | 分割後にGroupIdがクリアされる | 全DetailのGroupId = null |
| 5 | 分割後に摘要が再生成される | SummaryGeneratorで再生成された値 |
| 6 | 空摘要の場合「（分割）」がフォールバック | summary = "（分割）" |
| 7 | IsLentRecordが常にfalse | 新規Ledger.IsLentRecord = false |
| 8 | 操作ログが記録される | OperationLogger.LogAsync("SPLIT") |

**テストクラス:** `LedgerSplitServiceTests`

---

### 2.7 残高整合性チェック（LedgerConsistencyChecker）

#### UT-007: 残高チェーン整合性検証

| No | テストケース | 期待結果 |
|----|-------------|---------|
| 1 | 整合性のある履歴チェーン | IsConsistent = true |
| 2 | 残高不整合がある場合 | IsConsistent = false、Inconsistenciesに不整合レコード |
| 3 | 前回残高+受入-払出≠今回残高 | 期待残高と実際残高の差分を検出 |
| 4 | 1件のみの場合 | IsConsistent = true（比較対象なし） |
| 5 | 直前Ledgerを含む検証 | CheckConsistencyWithPreviousAsync正常動作 |

**テストクラス:** `LedgerConsistencyCheckerTests`

---

### 2.8 残高チェーン順序復元（LedgerOrderHelper）

#### UT-008: Ledger順序の復元

| No | テストケース | 期待結果 |
|----|-------------|---------|
| 1 | 正常なチェーンの順序維持 | 入力順序が維持される |
| 2 | 順序が乱れたチェーンの復元 | 残高チェーンに基づく正しい順序 |
| 3 | 前回残高指定ありの場合 | precedingBalanceから開始して正しい順序 |
| 4 | 特殊レコード（チャージ等）の処理 | 特殊レコードが正しく位置付けられる |
| 5 | 空リストの場合 | 空リストが返される |

**テストクラス:** `LedgerOrderHelperTests`

---

### 2.9 入力バリデーション（ValidationService）

#### UT-009: 入力値の検証

| No | テストケース | 入力 | 期待結果 |
|----|-------------|------|---------|
| 1 | 正しいIDm（16桁16進数） | "0123456789ABCDEF" | IsValid = true |
| 2 | IDm長さ不正 | "01234567" | IsValid = false |
| 3 | IDm非16進数文字 | "GHIJKLMNOPQRSTUV" | IsValid = false |
| 4 | カード番号最大長超過 | 21文字以上 | IsValid = false |
| 5 | 職員名必須チェック | "" | IsValid = false |
| 6 | 職員名最大長超過 | 51文字以上 | IsValid = false |
| 7 | 警告残高範囲チェック（正常） | 5000 | IsValid = true |
| 8 | 警告残高範囲チェック（超過） | 25000 | IsValid = false |
| 9 | バス停名最大長チェック | 101文字以上 | IsValid = false |

**テストクラス:** `ValidationServiceTests`

---

### 2.10 バックアップサービス（BackupService）

#### UT-010: バックアップ・リストア処理

| No | テストケース | 期待結果 |
|----|-------------|---------|
| 1 | 自動バックアップ成功 | バックアップファイルが作成される |
| 2 | バックアップパス未設定時のフォールバック | デフォルトパスが使用される |
| 3 | 無効なパスのフォールバック | デフォルトパスにフォールバック |
| 4 | バックアップファイル一覧取得 | 日時降順でファイル一覧 |
| 5 | 30世代超過時の古いファイル削除 | 最新30件のみ保持 |
| 6 | リストア成功 | DB接続クローズ→ファイル差替え→成功 |
| 7 | リストア失敗時のロールバック | .tempから元DBを復元 |

**テストクラス:** `BackupServiceTests`

---

### 2.11 キャッシュサービス（CacheService）

#### UT-011: メモリキャッシュ操作

| No | テストケース | 期待結果 |
|----|-------------|---------|
| 1 | キャッシュの取得・設定 | Set→Get で同じ値が返る |
| 2 | GetOrCreateAsync初回呼び出し | factory関数が実行される |
| 3 | GetOrCreateAsync2回目（キャッシュヒット） | factory関数が実行されない |
| 4 | キャッシュの無効化（Invalidate） | 指定キーが削除される |
| 5 | プレフィックスによる一括無効化 | 該当キーが全て削除される |
| 6 | 全クリア（Clear） | 全キーが削除される |
| 7 | 有効期限切れ | 期限後はnull/factory再実行 |

**テストクラス:** `CacheServiceTests`

---

### 2.12 ViewModelBase基底クラス

#### UT-012: ビジー状態・プログレス管理

| No | テストケース | 期待結果 |
|----|-------------|---------|
| 1 | 初期状態 | IsBusy=false, IsIndeterminate=true |
| 2 | SetBusy(true) | IsBusy=true, BusyMessage設定 |
| 3 | SetBusy(false) | プログレスがリセットされる |
| 4 | SetProgress | IsIndeterminate=false, 値更新 |
| 5 | BeginBusy スコープ開始/終了 | IsBusy遷移 true→false |
| 6 | BeginCancellableBusy | CanCancel=true |
| 7 | CancelOperation | IsCancellationRequested=true |
| 8 | BusyScope.ReportProgress | プログレス値更新 |
| 9 | BusyScope.ThrowIfCancellationRequested | キャンセル後にOperationCanceledException |

**テストクラス:** `ViewModelBaseTests`

---

### 2.13 ErrorDialogHelperエラー情報マッピング

#### UT-013: 例外→エラーコード変換

| No | テストケース | 入力例外 | 期待エラーコード |
|----|-------------|---------|----------------|
| 1 | CardReaderException | NotConnected() | CR001 |
| 2 | DatabaseException | ConnectionFailed() | DB001 |
| 3 | BusinessException | CardAlreadyLent() | BIZ001 |
| 4 | ValidationException | Required() | VAL001 |
| 5 | FileOperationException | FileNotFound() | FILE001 |
| 6 | UnauthorizedAccessException | - | SYS001 |
| 7 | IOException | - | SYS002 |
| 8 | TimeoutException | - | SYS003 |
| 9 | InvalidOperationException | - | SYS004 |
| 10 | ArgumentException | - | SYS005 |
| 11 | NotSupportedException | - | SYS006 |
| 12 | 未知の例外 | Exception | SYS999 |

**テストクラス:** `ErrorDialogHelperTests`

---

### 2.14 FileOperationException例外

#### UT-014: ファイル操作例外のファクトリメソッド

| No | テストケース | ファクトリメソッド | 期待エラーコード |
|----|-------------|-------------------|----------------|
| 1 | ファイル未検出 | FileNotFound(path) | FILE001 |
| 2 | 読み込み失敗 | ReadFailed(path) | FILE002 |
| 3 | 書き込み失敗 | WriteFailed(path) | FILE003 |
| 4 | アクセス拒否 | AccessDenied(path) | FILE004 |
| 5 | ファイル使用中 | FileInUse(path) | FILE005 |
| 6 | 無効な形式 | InvalidFormat(path) | FILE006 |
| 7 | ディレクトリ作成失敗 | DirectoryCreationFailed(path) | FILE007 |
| 8 | FilePathプロパティ保持 | 各メソッド | 指定パスが保持される |
| 9 | エラーコード一意性 | 全メソッド | FILE001〜FILE007が重複しない |

**テストクラス:** `AppExceptionTests`（FileOperationExceptionリージョン）

---

### 2.15 DtoMapperマッピング

#### UT-015: DTO変換

| No | テストケース | 期待結果 |
|----|-------------|---------|
| 1 | Staff → StaffDto変換 | 全プロパティが正しくマッピング |
| 2 | IcCard → CardDto変換 | 全プロパティが正しくマッピング |
| 3 | Ledger → LedgerDto変換 | Detail含む全プロパティがマッピング |
| 4 | null入力 | 例外またはnull返却 |
| 5 | コレクション変換 | リスト全要素が正しく変換 |

**テストクラス:** `DtoMapperTests`

---

## 3. 結合テスト

### 3.1 貸出・返却フロー

#### IT-001: 正常な貸出→返却フロー

**事前条件:**
- 職員「山田太郎」が登録済み
- 交通系ICカード「001」が登録済み・未貸出状態
- カード残額: 5,000円

**手順:**
1. 職員証「山田太郎」をタッチ
2. 交通系ICカード「001」をタッチ（貸出）
3. 外出して鉄道を利用（博多→天神 片道260円）
4. 職員証「山田太郎」をタッチ
5. 交通系ICカード「001」をタッチ（返却）

**期待結果:**
- 貸出時: 「いってらっしゃい！」表示、背景オレンジ
- 返却時: 「おかえりなさい！」表示、背景水色
- ledgerテーブルに履歴登録:
  - 摘要: "鉄道（博多～天神）"
  - 払出金額: 260
  - 残額: 4,740
  - 氏名: "山田太郎"

---

#### IT-002: バス利用を含む返却フロー

**事前条件:**
- 職員「鈴木花子」が登録済み
- 交通系ICカード「002」が登録済み・貸出中

**手順:**
1. バスを利用（運賃260円）
2. 職員証「鈴木花子」をタッチ
3. 交通系ICカード「002」をタッチ（返却）
4. バス停入力画面でバス停名を入力

**期待結果:**
- 返却処理完了
- バス停入力画面が表示される
- 摘要に「バス（★）」が含まれる
- バス停名入力後、摘要が更新される

---

#### IT-003: 30秒ルールによる再貸出

**事前条件:**
- 職員「田中次郎」が登録済み
- 交通系ICカード「003」が登録済み・貸出中

**手順:**
1. 返却処理を実行
2. 25秒以内に再度貸出操作を実行

**期待結果:**
- 返却処理が完了扱いになる
- 新規貸出として処理される
- バス停入力画面が開いている場合は閉じる

---

### 3.2 履歴表示・修正フロー

#### IT-004: 履歴表示と修正

**事前条件:**
- 交通系ICカード「001」に履歴が存在

**手順:**
1. 交通系ICカード「001」をタッチ（職員証なし）
2. 履歴表示画面が開く
3. 任意の行で「修正」ボタンをクリック
4. 職員証をタッチ
5. 摘要を修正して「完了」をクリック

**期待結果:**
- 履歴が正しく表示される
- 修正モード時は背景が薄い黄色
- 修正内容がDBに反映される
- operation_logに修正ログが記録される

---

### 3.3 カード・職員管理フロー

#### IT-005: 交通系ICカード登録

**事前条件:**
- 操作者の職員証が登録済み

**手順:**
1. カード管理画面を開く
2. 「追加」ボタンをクリック
3. 操作者の職員証をタッチ
4. 新規交通系ICカードをタッチ
5. 通し番号「005」を入力
6. 「登録」ボタンをクリック

**期待結果:**
- カード種別をユーザーがドロップダウンから選択できる
- ic_cardテーブルに登録される
- operation_logに登録ログが記録される

---

#### IT-006: 職員の論理削除と履歴表示

**事前条件:**
- 職員「佐藤三郎」が登録済み
- 「佐藤三郎」による利用履歴が存在

**手順:**
1. 職員管理画面で「佐藤三郎」を削除
2. 削除後、関連する履歴を表示

**期待結果:**
- staffテーブルでis_deleted=1, deleted_atが設定
- 物理削除はされない
- 履歴表示時に「佐藤三郎」の氏名が表示される

---

#### IT-007: 履歴統合→元に戻すフロー

**事前条件:**
- カード「001」に同一日の履歴が3件存在

**手順:**
1. 履歴詳細画面で3件を選択
2. 統合ボタンをクリック
3. 職員認証を実施
4. 統合完了を確認
5. 元に戻すボタンをクリック
6. 元の3件に復元されることを確認

**期待結果:**
- 統合後: 1件のLedgerに3件分のDetailが統合
- 摘要が再生成される
- 元に戻す後: 元の3件が復元される
- 操作ログにMERGE/UNMERGEが記録される

---

#### IT-008: 履歴分割→残高整合性チェックフロー

**事前条件:**
- カード「001」に複数Detailを含むLedgerが1件存在

**手順:**
1. 履歴詳細画面でDetailを2グループに分ける
2. 分割ボタンをクリック
3. 職員認証を実施
4. 分割後に残高整合性チェックを実行

**期待結果:**
- 分割後: 元Ledger更新 + 新Ledger1件作成
- 各Ledgerの金額がCalculateGroupFinancialsで正しく計算
- 残高整合性チェックがIsConsistent = trueを返す
- 操作ログにSPLITが記録される

---

#### IT-009: CSVエクスポート→インポート往復フロー

**事前条件:**
- 職員データが5件登録済み

**手順:**
1. データエクスポート画面で職員データをCSVエクスポート
2. エクスポートしたCSVファイルを確認
3. データインポート画面で同じCSVをプレビュー
4. インポートを実行（skipExisting = true）

**期待結果:**
- エクスポート: 5件がCSV出力される
- インポートプレビュー: 5件が「スキップ」として表示
- インポート実行: SkippedCount = 5、InsertedCount = 0
- データの整合性が保たれる

---

## 4. システムテスト

### 4.1 画面遷移テスト

#### ST-001: メイン画面からの遷移

| No | 操作 | 遷移先 | 戻り操作 |
|----|------|--------|---------|
| 1 | F1キー押下 | 帳票画面 | 閉じるボタン |
| 2 | F2キー押下 | 職員管理画面 | Escキー |
| 3 | F3キー押下 | カード管理画面 | Escキー |
| 4 | F4キー押下 | データ入出力画面 | 閉じるボタン |
| 5 | F5キー押下 | 設定画面 | 閉じるボタン |
| 6 | F6キー押下 | システム管理画面 | 閉じるボタン |
| 7 | F7キー押下 | ヘルプ（ドキュメントフォルダ） | - |

---

### 4.2 エラー処理テスト

#### ST-002: エラー処理

| No | テストケース | 操作 | 期待結果 |
|----|-------------|------|---------|
| 1 | 貸出中カード重複貸出 | 貸出中カードをタッチ | 返却処理へ移行 |
| 2 | 未登録カード | 未登録カードをタッチ | 登録確認ダイアログ表示 |
| 3 | ICカード待ち中に職員証 | 職員証をタッチ | エラー音、メッセージ表示 |
| 4 | タイムアウト | 60秒待機 | エラー音、状態リセット |
| 5 | DB書き込み失敗 | DBファイルを読み取り専用に | エラーメッセージ表示 |

---

### 4.3 残額警告テスト

#### ST-003: 残額警告

**事前条件:**
- 警告閾値: 10,000円

| No | 残額 | 期待結果 |
|----|------|---------|
| 1 | 15,000円 | 警告なし |
| 2 | 10,000円 | 警告なし（閾値以上） |
| 3 | 9,999円 | 警告表示 |
| 4 | 0円 | 警告表示 |

---

### 4.4 バックアップテスト

#### ST-004: 自動バックアップ

**手順:**
1. アプリケーションを起動
2. バックアップフォルダを確認

**期待結果:**
- backup_YYYYMMDD_HHMMSS.db 形式のファイルが作成
- 30世代を超えた場合、古いファイルが削除される

---

### 4.5 月次帳票テスト

#### ST-005: Excel出力

**事前条件:**
- 2025年4月の履歴が存在
- 2025年3月の履歴が存在

| No | テストケース | 期待結果 |
|----|-------------|---------|
| 1 | 4月の帳票 | 「前年度より繰越」行が先頭に存在 |
| 2 | 4月の帳票（累計行なし） | 累計行が出力されない（4月は年度開始のため累計不要） |
| 3 | 3月の帳票 | 「累計」「次年度へ繰越」行が末尾に存在 |
| 4 | 月計行 | 月の合計が正しく計算される |
| 5 | 月計行（受入・払出が0円） | 月計行が出力される（0円でも省略しない） |
| 6 | ページ番号 | ページ番号が正しく設定される |

---

## 5. 性能テスト

### 5.1 応答性能

#### PT-001: カードタッチ応答

| No | 操作 | 目標応答時間 |
|----|------|-------------|
| 1 | カードタッチ検出 | 500ms以内 |
| 2 | 貸出処理完了 | 1秒以内 |
| 3 | 返却処理完了（履歴読込含む） | 3秒以内 |
| 4 | 履歴表示画面表示 | 2秒以内 |

---

### 5.2 データ量テスト

#### PT-002: 大量データ処理

| No | テストケース | データ量 | 期待結果 |
|----|-------------|---------|---------|
| 1 | 履歴表示 | 10,000件 | ページングで100件ずつ表示 |
| 2 | 月次帳票 | 1,000件/月 | 正常に出力 |
| 3 | 検索 | 50,000件 | 2秒以内に結果表示 |

---

## 6. セキュリティテスト

### 6.1 データ保護

#### SEC-001: データ保護確認

| No | テストケース | 確認内容 |
|----|-------------|---------|
| 1 | DBファイルアクセス権限 | %PROGRAMDATA%配下にDBが配置され、OSレベルのアクセス制御が有効なこと |
| 2 | 操作ログ記録 | 貸出・返却・登録・編集・削除・統合等の重要操作がoperation_logに記録されること |
| 3 | 論理削除によるデータ保持 | 職員・カードの削除時に物理削除されず、履歴参照が維持されること |

---

## 7. 受入テスト

### 7.1 業務シナリオテスト

#### UAT-001: 通常業務フロー

**シナリオ:** 職員Aが出張のためICカードを借り、帰社後に返却する

**手順:**
1. 朝、職員AがICカード「001」を借りる
2. 電車で移動（博多→天神→赤坂）
3. バスで移動
4. 帰社後、ICカードを返却
5. バス停名を入力
6. 履歴が正しく記録されていることを確認

**確認項目:**
- [ ] 貸出時の画面表示が適切
- [ ] 返却時の画面表示が適切
- [ ] バス停入力画面が表示される
- [ ] 履歴の摘要が正しい
- [ ] 金額が正しい
- [ ] 職員名が記録されている

---

#### UAT-002: 月次処理フロー

**シナリオ:** 月末に当月の物品出納簿を作成する

**手順:**
1. 月次帳票作成画面を開く
2. 対象月を選択
3. 出力するカードを選択
4. Excelファイル作成をクリック
5. 出力されたファイルを確認

**確認項目:**
- [ ] 対象月のデータが正しく出力される
- [ ] ヘッダ情報（物品分類、品名、規格）が正しい
- [ ] 月計行の金額が正しい
- [ ] 和暦表示が正しい

---

## 8. テスト完了基準

### 8.1 必須基準

| 項目 | 基準 |
|------|------|
| 単体テスト | 全件パス（現在1,613件） |
| 結合テスト | 全件パス |
| UIテスト | 全件パス（現在9件） |
| システムテスト | 重大バグ0件、軽微バグ5件以下 |
| 受入テスト | 全シナリオパス |

### 8.2 推奨基準

| 項目 | 基準 |
|------|------|
| コードカバレッジ | 80%以上 |
| 性能テスト | 全項目が目標値以内 |
| 自動テスト合計 | 1,600件以上を維持 |

---

## 9. バグ管理

### 9.1 バグ重要度定義

| 重要度 | 定義 | 対応期限 |
|--------|------|---------|
| Critical | システム停止、データ破損 | 即時対応 |
| Major | 主要機能が使用不可 | 1日以内 |
| Minor | 回避策あり、軽微な問題 | 1週間以内 |
| Trivial | 表示上の問題等 | 次回リリース |

---

## 10. テストデータ

### 10.1 職員テストデータ

| IDm | 氏名 | 職員番号 |
|-----|------|---------|
| TEST001 | 山田太郎 | E001 |
| TEST002 | 鈴木花子 | E002 |
| TEST003 | 田中次郎 | E003 |
| TEST004 | 佐藤三郎 | E004 |

### 10.2 ICカードテストデータ

| IDm | 通し番号 | カード種別 |
|-----|---------|-----------|
| 07FE11111111 | 001 | はやかけん |
| 05FE22222222 | 002 | nimoca |
| 06FE33333333 | 003 | SUGOCA |

### 10.3 履歴テストデータ

テスト用の履歴データは、以下のパターンを網羅するように作成:
- 鉄道利用（片道、往復、乗継、複数区間）
- バス利用
- チャージ
- 複数日にまたがる利用
- 月をまたぐ利用
- 年度をまたぐ利用
